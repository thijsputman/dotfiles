#!/usr/bin/env bash

# Mimic output of update-notifier-common on non-Ubuntu (ie. Debian) systems.
# This relies on the "apt-check" output generated by my sysmon-mqtt script. See
# <https://github.com/thijsputman/home-assistant-config/tree/main/extras/sysmon-mqtt>
# for details...

if ! [ -f /etc/update-motd.d/90-updates-available ] && [ -s ~/.apt-check ]; then

  # Only show as part of pre-existing (full) MOTD
  if [[ "$HEADER_SHOWN" == motd* ]] ; then

    updates_available=$(head -n 1 ~/.apt-check)

    if [ "$updates_available" -gt 0 ] ; then
      printf "%d update(s) can be applied immediately.\n" "$updates_available"
      printf "To see these additional updates run: apt list --upgradable\n"
      printf "\n"
    fi

  fi

fi
