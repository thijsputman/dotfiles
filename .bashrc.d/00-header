#!/usr/bin/env bash

# If the first argument passed to Bash starts with 'ssh ', don't do anything.
# This prevents duplicate output (once local; once remote) in cases where
# "bash -i -c $0 'ssh ...'" is used to directly start a SSH session.

if [[ $0 != 'ssh '* ]]; then

  HEADER_SHOWN=motd

  # If no MOTD was shown _or_ we're running inside VS Code's integrated
  # terminal, we'll show a short/single-line header instead
  if
    [ -z "$MOTD_SHOWN" ] || [ "$TERM_PROGRAM" == "vscode" ]
  then
    . /etc/update-motd.d/00-header
    HEADER_SHOWN=short
  # Assume an SSH-session always sees a full MOTD(-like) header. Ubuntu up to
  # 22.04 would set MOTD_SHOWN=pam, but since 23.04 there doesn't appear to be
  # a better way to determine whether the MOTD was shown..
  elif [ -n "$SSH_CLIENT" ] || [ -n "$SSH_TTY" ]; then
    HEADER_SHOWN=motd-ssh
  fi

  # In case of VS Code's intergrated terminal, we don't want to see any further
  # (header) output generated by the bashrc.d-scripts
  if [ "$TERM_PROGRAM" == vscode ]; then
    unset HEADER_SHOWN
  fi

  export HEADER_SHOWN

  # Separate MOTD/header from the rest of the output
  printf "\n"

fi
